/***************************************************************************//**
  @file     drv_leds.h
  @brief    Drivers de los leds
  @author   Dimas Bosch
 ******************************************************************************/

/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/
#include "drv_leds.h"
#include "gpio.h"
#include "timer.h"
/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/

/*******************************************************************************
 * ENUMERATIONS AND STRUCTURES AND TYPEDEFS
 ******************************************************************************/
enum{
	PIN_STATUS0 = PORTNUM2PIN(PA, 2),
	PIN_STATUS1 = PORTNUM2PIN(PC, 2)
};


/*******************************************************************************
 * VARIABLES WITH GLOBAL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/

static void setLED(int led);
static void printStatus(void);

/*******************************************************************************
 * ROM CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

static int state = 1;

/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/
void DRV_Init_LEDs(void)
{
	gpioMode(PIN_STATUS0, OUTPUT);
	gpioMode(PIN_STATUS1, OUTPUT);
	timerStart(timerGetId(), TIMER_MS_2_TICKS(LEDS_REFRESH_RATE_MS), TIM_MODE_PERIODIC, printStatus);
}


void printStatus(void)
{
	for (int i=0;i<3;i++)
	{
		if((state) & (1<<i))
			{
				setLED(i+1);
			}
	}
	setLED(0);
}


/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/
void setLED(int led)
{
	gpioWrite(PIN_STATUS0, (led & (1)));
	gpioWrite(PIN_STATUS1, (led & (1<<1)));
}

void changeState(int stat)
{
	state=stat;
}



 
